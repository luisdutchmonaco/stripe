define(["exports","metal/src/metal","metal-uri/src/Uri","metal-promise/src/promise/Promise"],function(e,t,r,n){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var u=a(r),i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),l=function(){function e(){o(this,e)}return i(e,null,[{key:"parseResponseHeaders",value:function(e){var t=[];if(!e)return t;for(var r=e.split("\r\n"),n=0;n<r.length;n++){var a=r[n].indexOf(": ");if(a>0){var o=r[n].substring(0,a),u=r[n].substring(a+2);t.push({name:o,value:u})}}return t}},{key:"request",value:function r(e,a,o,i,l,s,f,c){e=e||"",a=a||"GET";var r=new XMLHttpRequest,d=0,m=new n.CancellablePromise(function(e,t){r.onload=function(){return r.aborted?void r.onerror():void e(r)},r.onreadystatechange=function(){d&&d<3&&4===r.readyState&&(r.terminatedPrematurely=!0),d=r.readyState},r.onerror=function(){var e="Request error";r.terminatedPrematurely&&(e="Request terminated prematurely");var n=new Error(e);n.request=r,t(n)}}).thenCatch(function(e){throw r.abort(),e}).thenAlways(function(){clearTimeout(v)});if(e=new u["default"](e),l&&e.addParametersFromMultiMap(l).toString(),e=e.toString(),r.open(a,e,!f),c&&(r.withCredentials=!0),i&&i.names().forEach(function(e){r.setRequestHeader(e,i.getAll(e).join(", "))}),r.send((0,t.isDef)(o)?o:null),(0,t.isDefAndNotNull)(s))var v=setTimeout(function(){m.cancel("Request timeout")},s);return m}}]),e}();e["default"]=l});