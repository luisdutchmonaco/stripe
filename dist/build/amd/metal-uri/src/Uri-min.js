define(["exports","metal/src/metal","./parse","metal-structs/src/all/structs"],function(e,t,r,n){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}function u(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var i=a(r),o=function(){function e(e,t){var r=[],n=!0,a=!1,u=void 0;try{for(var i,o=e[Symbol.iterator]();!(n=(i=o.next()).done)&&(r.push(i.value),!t||r.length!==t);n=!0);}catch(s){a=!0,u=s}finally{try{!n&&o["return"]&&o["return"]()}finally{if(a)throw u}}return r}return function(t,r){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),s=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),l=i["default"],c=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";u(this,e),this.url=e.parse(this.maybeAddProtocolAndHostname_(t))}return s(e,[{key:"addParametersFromMultiMap",value:function(e){var t=this;return e.names().forEach(function(r){e.getAll(r).forEach(function(e){t.addParameterValue(r,e)})}),this}},{key:"addParameterValue",value:function(e,r){return this.ensureQueryInitialized_(),(0,t.isDef)(r)&&(r=String(r)),this.query.add(e,r),this}},{key:"addParameterValues",value:function(e,t){var r=this;return t.forEach(function(t){return r.addParameterValue(e,t)}),this}},{key:"ensureQueryInitialized_",value:function(){var r=this;if(!this.query){this.query=new n.MultiMap;var a=this.url.search;a&&a.substring(1).split("&").forEach(function(n){var a=n.split("="),u=o(a,2),i=u[0],s=u[1];(0,t.isDef)(s)&&(s=e.urlDecode(s)),r.addParameterValue(i,s)})}}},{key:"getHash",value:function(){return this.url.hash||""}},{key:"getHost",value:function(){var e=this.getHostname();if(e){var t=this.getPort();t&&"80"!==t&&(e+=":"+t)}return e}},{key:"getHostname",value:function(){var t=this.url.hostname;return t===e.HOSTNAME_PLACEHOLDER?"":t}},{key:"getOrigin",value:function(){var e=this.getHost();return e?this.getProtocol()+"//"+e:""}},{key:"getParameterValue",value:function(e){return this.ensureQueryInitialized_(),this.query.get(e)}},{key:"getParameterValues",value:function(e){return this.ensureQueryInitialized_(),this.query.getAll(e)}},{key:"getParameterNames",value:function(){return this.ensureQueryInitialized_(),this.query.names()}},{key:"getPathname",value:function(){return this.url.pathname}},{key:"getPort",value:function(){return this.url.port}},{key:"getProtocol",value:function(){return this.url.protocol}},{key:"getSearch",value:function(){var e=this,r="",n="";return this.getParameterNames().forEach(function(r){e.getParameterValues(r).forEach(function(e){n+=r,(0,t.isDef)(e)&&(n+="="+encodeURIComponent(e)),n+="&"})}),n=n.slice(0,-1),n&&(r+="?"+n),r}},{key:"hasParameter",value:function(e){return this.ensureQueryInitialized_(),this.query.contains(e)}},{key:"makeUnique",value:function(){return this.setParameterValue(e.RANDOM_PARAM,t.string.getRandomString()),this}},{key:"maybeAddProtocolAndHostname_",value:function(t){var r=t;if(t.indexOf("://")===-1&&0!==t.indexOf("javascript:"))switch(r=e.DEFAULT_PROTOCOL,"/"===t[0]&&"/"===t[1]||(r+="//"),t.charAt(0)){case".":case"?":case"#":r+=e.HOSTNAME_PLACEHOLDER,r+="/",r+=t;break;case"":case"/":"/"!==t[1]&&(r+=e.HOSTNAME_PLACEHOLDER),r+=t;break;default:r+=t}return r}},{key:"removeParameter",value:function(e){return this.ensureQueryInitialized_(),this.query.remove(e),this}},{key:"removeUnique",value:function(){return this.removeParameter(e.RANDOM_PARAM),this}},{key:"setHash",value:function(e){return this.url.hash=e,this}},{key:"setHostname",value:function(e){return this.url.hostname=e,this}},{key:"setParameterValue",value:function(e,t){return this.removeParameter(e),this.addParameterValue(e,t),this}},{key:"setParameterValues",value:function(e,t){var r=this;return this.removeParameter(e),t.forEach(function(t){return r.addParameterValue(e,t)}),this}},{key:"setPathname",value:function(e){return this.url.pathname=e,this}},{key:"setPort",value:function(e){return this.url.port=e,this}},{key:"setProtocol",value:function(e){return this.url.protocol=e,":"!==this.url.protocol[this.url.protocol.length-1]&&(this.url.protocol+=":"),this}},{key:"toString",value:function(){var e="",t=this.getHost();return t&&(e+=this.getProtocol()+"//"),e+=t+this.getPathname()+this.getSearch()+this.getHash()}}],[{key:"getParseFn",value:function(){return l}},{key:"parse",value:function(e){return l(e)}},{key:"setParseFn",value:function(e){l=e}},{key:"joinPaths",value:function(e){for(var t=arguments.length,r=Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];return"/"===e.charAt(e.length-1)&&(e=e.substring(0,e.length-1)),r=r.map(function(e){return"/"===e.charAt(0)?e.substring(1):e}),[e].concat(r).join("/").replace(/\/$/,"")}},{key:"urlDecode",value:function(e){return decodeURIComponent(e.replace(/\+/g," "))}}]),e}(),h=function(){return"undefined"!=typeof window&&window.location&&window.location.protocol&&0===window.location.protocol.indexOf("https")};c.DEFAULT_PROTOCOL=h()?"https:":"http:",c.HOSTNAME_PLACEHOLDER="hostname"+Date.now(),c.RANDOM_PARAM="zx",e["default"]=c});